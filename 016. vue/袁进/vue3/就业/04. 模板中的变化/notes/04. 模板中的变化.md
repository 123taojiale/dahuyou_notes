## 04. 模板中的变化 {ignore}

[toc]

### 前言

- 时长：46min

本节课实现了一个小 demo：

![20211031102158](https://cdn.jsdelivr.net/gh/123taojiale/dahuyou_picture@main/blogs/20211031102158.png)

feature：
- 销售中显示的商品，都是选中的商品，未选中的商品不显示；
- 商品名被修改后，销售中对应商品的名称也会随之变化；

通过这个 demo 来体验 v-model 的一些变化。

### v-model

`vue2` 比较让人诟病的一点就是提供了两种双向绑定：`v-model` 和 `.sync`，在 `vue3` 中，去掉了 `.sync` 修饰符，只需要使用 `v-model` 进行双向绑定即可。

为了让 `v-model` 更好地针对多个属性进行双向绑定，`vue3` 作出了以下修改：
- 当对自定义组件使用 `v-model` 指令时，绑定的属性名由原来的`value`变为`modelValue`，事件名由原来的 `input` 变为 `update:modelValue`。
- 去掉了 `.sync` 修饰符，它原本的功能由 `v-model` 的参数替代。
- `model` 配置被移除。[doc model](https://cn.vuejs.org/v2/api/#model)
- 允许自定义 `v-model` 修饰符。

> 以上提及的这几点，都是 vue2 所不具备的。

- [ ] v-model

```html
<!-- vue2 中 v-model 的原理 -->
<ChildComponent :value="pageTitle" @input="pageTitle = $event" />
<!-- 简写为 -->
<ChildComponent v-model="pageTitle" />
```

```html
<!-- vue3 中 v-model 的原理 -->
<ChildComponent
  :modelValue="pageTitle"
  @update:modelValue="pageTitle = $event"
/>
<!-- 简写为 -->
<ChildComponent v-model="pageTitle" />
```

- [ ] 多属性的双向绑定

```html
<!-- vue2 中，多属性双向绑定的写法 -->
<ChildComponent :title="pageTitle" @update:title="pageTitle = $event" />
<!-- 简写为 -->
<ChildComponent :title.sync="pageTitle" />
```

```html
<!-- vue3 中，多属性双向绑定的写法 -->
<ChildComponent :title="pageTitle" @update:title="pageTitle = $event" />
<!-- 简写为 -->
<ChildComponent v-model:title="pageTitle" />
```

![20211031092216](https://cdn.jsdelivr.net/gh/123taojiale/dahuyou_picture@main/blogs/20211031092216.png)

在过去的时候，我们也许会接触到这样的面试题：“sync、v-model 之间的区别？”。除了写法上有点不同以外，其实它们本质上都是一样的，都是用来实现数据的双向绑定的，同样的功能，整出俩玩意儿，这点我们可以理解为是 vue 设计上的一个缺陷，所以，在 vue3 中，就直接将 sync 去掉了。注意这种截断式（breaking）的更新，sync 是不兼容过去的写法的。所以，当我们还想实现多属性的双向绑定时，就不能在使用 `.sync` 修饰符了。

### v-if v-for

- 在 vue2 中：`v-if` 的优先级低于 `v-for`。
- 在 vue3 中：`v-if` 的优先级高于 `v-for`。

优先级高的会先执行。

### key

- 当使用 `<template>` 进行 `v-for` 循环时，需要把 `key` 值放到 `<template>` 中，而不是它的子元素中。
- 当使用 `v-if v-else-if v-else` 分支的时候，不再需要指定 `key` 值，因为 `vue3` 会自动给予每个分支一个唯一的 `key`
  即便要手工给予 `key` 值，也必须给予每个分支唯一的 `key`，**不能因为要重用分支而给予相同的 `key`**。

```html
<!-- vue2 -->
<div>
  <template v-for="(item, index) in itemList">
    <span :key="index">第{{ index }}项：</span>
    <strong :key="index">{{ item.name }}</strong>
  </template>
</div>
```

```html
<!-- vue3 -->
<div>
  <template v-for="(item, index) in itemList" :key="index">
    <span>第{{ index }}项：</span>
    <strong>{{ item.name }}</strong>
  </template>
</div>
```

- [ ] key、v-if

```html
<div id="app">
  <div v-if="isAccount" :key="1">
    <label>账号：</label>
    <input type="text">
  </div>
  <div v-else :key="2">
    <label>手机号：</label>
    <input type="text">
  </div>
  <button @click="isAccount = !isAccount">切换登录方式</button>
</div>
```

```js
// vue2
new Vue({
  el: "#app",
  data: {
    isAccount: true,
  },
});
```

在 vue2 中，若我们没有绑定上 key 值，那么当我们切换登录方式的时候，值会保留。这往往不是我们希望看到的效果，算是一个 bug。（如果真有这样的需求，那也应该是使用 v-model 绑定相同的响应式数据来实现，or 其他方式。）我们得加上不同的 key 值，才可以解决这样的问题。

![20211031182324](https://cdn.jsdelivr.net/gh/123taojiale/dahuyou_picture@main/blogs/20211031182324.png)

但是，在 vue3 中，我们就不需要手动去加 key，就可以实现想要的效果。

```html
<div id="app"></div>
<script src="https://unpkg.com/vue@next"></script>
<script>
  // vue3
  Vue.createApp({
    template: `
      <div v-if="isAccount">
        <label>账号：</label>
        <input type="text">
      </div>
      <div v-else>
        <label>手机号：</label>
        <input type="text">
      </div>
      <button @click="isAccount = !isAccount">切换登录方式</button>
    `,
    data() {
      return {
        isAccount: true,
      }
    }
  }).mount("#app");
</script>
```

### Fragment

`vue3` 现在允许组件出现多个根节点。

> 类似于 react 的 fragment。

若我们在 vue3 中书写多个根节点时，出现红线警告（不影响最终的运行结果），那很可能是我们安装的 vetur 插件导致的。只要打开配置，搜索 vetur template，将对应的勾选取消掉即可。

![20211031180848](https://cdn.jsdelivr.net/gh/123taojiale/dahuyou_picture@main/blogs/20211031180848.png)

### 版本

| 版本名称 | 介绍   | 说明                                       |
| -------- | ------ | ------------------------------------------ |
| alpha    | 内测版 | 内部测试版本                               |
| beta     | 公测版 | Beta 阶段会一直加入新的功能                |
| RC       | 候选版 | 几乎就不会加入新的功能了，而主要着重于除错 |
| Release  | 正式版 | 稳定版本                                   |

> 袁老在录制本教程时，vite 还是 RC 版，可能还存在不少尚未被发现的问题，所以当时还不推荐直接使用 vite 来搭建我们的项目。但是目前的 vite 已经是 Release 版了，现阶段直接拿来用便是。

- 如何查看当前的版本？

[vite github](https://github.com/vitejs/docs-cn)

![20211031164027](https://cdn.jsdelivr.net/gh/123taojiale/dahuyou_picture@main/blogs/20211031164027.png)