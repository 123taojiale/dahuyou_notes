# 回调泄露问题

测试 5.2.3 结尾提到的 Command + R 刷新的 bug

**现象**

![](https://raw.githubusercontent.com/123taojiale/dahuyou_picture/main/blogs/202208211744991.png)

每次刷新页面后，再去切换是否全屏显示，主进程就会抛出这个错误。

刷新 n 次之后再切换窗口的最大化，报错信息就会出现 n 条，因为泄露了 n 个事件。

**原因分析**

核心要理解一点：通过 `remote.getCurrentWindow()` 获取到的窗口对象，实际是一个远程对象，它实际是 **存在于主进程中** 的。

我们刷新的页面，它是一个渲染进程，每次刷新，脚本重新运行，但是每次刷新后，通过 `remote.getCurrentWindow()` 获取到的窗口对象都是同一个对象。但是，每次刷新页面后，都会重新创建绑定给该对象的回调函数，刷新一次，就会多绑定一个回调，并不会覆盖之前绑定的回调。每次刷新页面后，之前绑定的那个回调所在的上下文已经被释放，由于没法找到之前绑定的回调（回调泄露），所以报错了。

