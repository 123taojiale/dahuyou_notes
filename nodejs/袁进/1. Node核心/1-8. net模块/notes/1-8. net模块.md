## 1-8. net 模块 {ignore}

[toc]

### 回顾 http 请求

- 普通模式
  - ![20211024193505](https://cdn.jsdelivr.net/gh/123taojiale/dahuyou_picture@main/blogs/20211024193505.png)
- 长连接模式
  - ![20211024192205](https://cdn.jsdelivr.net/gh/123taojiale/dahuyou_picture@main/blogs/20211024192205.png)
  - `Connection: keep-alive`

三次握手、四次挥手，这些事儿操作系统都帮我们做好了，我们只需要关注 请求、响应 即可。长连接模式和普通模式之间的区别就在于 `Connection: keep-alive`，若是长连接模式，那么就不需要频繁地处理三次握手，四次挥手了，因为连接还没断开。但是，如果是普通模式，那么每次请求、响应，都要走一遍三次握手、四次挥手。

http 协议是建立在 TCP/IP 协议基础上的。三次握手、四次挥手，都是 TCP/IP 协议处理的。而 http 协议仅仅是说明了在 “黄色区域” 数据的格式应该是什么样的。

TCP/IP 协议比 http 协议更加底层，在 TCP/IP 协议中，客服端和服务器之间可以传输任何数据，客服端发出请求后，服务端可以选择响应或不响应，也可以响应多次；两端都有权中断连接。但是，在 http 协议下，就是由客户端发起请求，然后服务端响应请求，一个请求对应一个响应。

### net 模块能干什么

net 是一个通信模块，使用它，可以实现进程间的通信 IPC、网络通信 TCP/IP。

### 创建客户端

`net.createConnection(options[, connectListener])`

返回的是一个 socket。socket 是一个特殊的文件，在 node 中表现为一个**双工流**对象，通过向流写入内容的形式来发送数据，通过监听流的内容来获取数据。

![20211024192406](https://cdn.jsdelivr.net/gh/123taojiale/dahuyou_picture@main/blogs/20211024192406.png)

```js
// options
{
  host: xxx, // => 连接主机的地址
  port: xxx, // => 端口号
}
```

http 协议的默认端口号是 80，但是 TCP/IP 协议，没有默认端口号，我们必须得写明端口号。

### 创建服务器

`net.createServer()`

返回的是一个 server 对象。
- server.listen(port)：监听当前计算机中某个端口。
- server.on("listening", () => {})：开始监听端口后触发的事件。
- server.on("connection", socket => {})：当某个连接到来时，触发该事件，事件的监听函数会得到一个 socket 对象。
  - ![20211024193009](https://cdn.jsdelivr.net/gh/123taojiale/dahuyou_picture@main/blogs/20211024193009.png)
