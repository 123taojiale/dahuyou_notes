## 2-3. 使用第三方库简化流程 {ignore}

[toc]

### 前言

- 时长：8min

通过上节课学习的 typescript 的相关配置，我们已经可以实现：
- 编辑 tsconfig.js 文件；`... 配置`
- 在 src 目录下开开心心的写 ts 代码；
- 执行编译命令 tsc；`tsc`
- 在 dist 目录下生成我们需要的结果代码；
- 执行 dist 目录下的结果代码；`node ./dist/xxx.js`

但是，这流程还是比较繁琐的，我们还可以对上述流程进行简化。具体如何简化，就是本节课要介绍的内容。

### ts-node

简介：ts-node 是一个第三方库，它可以将 ts 代码在内存中完成编译，同时会运行编辑的结果（js 文件）。

安装：`npm i -g ts-node`

使用：有了这个包之后，我们只需要在 src 目录下写好我们的 ts 代码，然后执行 `ts-node ./src/xxx.ts` 命令即可。

Attention：
- 由于是在内存中编译并运行的，所以，它并没有给我们生成目标文件。不过，这点也正是我们在开发阶段希望看到的效果。
- 它并不会忽略 ts 配置文件，tsconfig.js 中的配置依旧是有效的。

### nodemon

使用 ts-node 虽然已经简化了流程，但是，我们每次修改 ts 文件后，还要手动输入命令 `ts-node ./src/xxx.ts` 去编译执行。如果我们希望 ts 文件内容发生变化后，就会自动编译并运行，那么可以使用 nodemon 这个第三方库。

简介：nodemon，全称应该是 node monitor，node 监视器。

> 开发 express、koa 这样的应用程序的时候，一般都会用到这个库。

doc：
- 官网：https://nodemon.io/
- npmjs：https://www.npmjs.com/package/nodemon

安装：`npm i -g nodemon`

使用：
- `nodemon --exec ts-node ./src/index.ts`
- 注解：exec 是 execute 的缩写，表示执行的意思。一旦监测（monitor）到我们的资源发生变化，就执行命令 `ts-node ./src/index.ts`。
  - 具体需要监测哪些资源，我们是可以通过 nodemon 的配置参数来指定的。
  - By default, nodemon looks for files with the `.js`, `.mjs`, `.coffee`, `.litcoffee`, and `.json` extensions.（译：默认情况下，nodemon 会监测以 `.js`、`.mjs`、`.coffee`、`.litcoffee`、`.json` 为后缀的文件）

命令有点长，我们可以将其配置到 package.json 的 scripts 字段中。

```json
// package.json
{
  "scripts": {
    "dev": "nodemon --exec ts-node ./src/index.ts"
  }
}
```

配置好 package.json 之后，我们下次启动时，就只需要执行 `npm run dev` 命令即可。

#### -e

命令参数：[-e](https://github.com/remy/nodemon#specifying-extension-watch-list)
![20211108180709](https://cdn.jsdelivr.net/gh/123taojiale/dahuyou_picture@main/blogs/20211108180709.png)

我们会发现，nodemon 它监测的文件，除了 `.ts` 文件之外，还会监测 `.json` 文件，监测的范围有点广，若我们只想让它监测 `.ts` 文件，那么又改如何实现呢？

我们可以在 nodemon 命令后边加上命令参数 `--ext`（简写 `-e`）来指定具体监测哪些后缀名的文件。只需要将原来配置的命令稍加修改即可：

```json
// package.json
{
  "scripts": {
    "dev": "nodemon -e ts --exec ts-node ./src/index.ts"
  }
}
```

> ext -> extension 扩展名，后缀名。

#### --watch

命令参数：[--watch](https://github.com/remy/nodemon#monitoring-multiple-directories)
![20211108183823](https://cdn.jsdelivr.net/gh/123taojiale/dahuyou_picture@main/blogs/20211108183823.png)

虽然通过 -e 配置了指监测 ts 文件的变化，但是，若根目录下存在一个 ts 文件，我们更改了该 ts 文件的内容，会发现 `./src/index.ts` 也会被执行一遍，这是因为我们还没有指定具体监测哪个目录，nodemon 默认会监测当前的工作目录下的所有 ts 文件。我们可以通过 --watch 这个参数来指定 nodemon 监测的目录。

```json
// package.json
{
  "scripts": {
    "dev": "nodemon --watch src -e ts --exec ts-node ./src/index.ts"
  }
}
```