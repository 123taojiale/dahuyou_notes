## 03. 新建任务 {ignore}

[toc]

### 前言

- 时长：

codes 见 [github](https://github.com/123taojiale/fenotes/tree/main/vue/%E8%A2%81%E8%BF%9B/vue3/%E5%85%A5%E9%97%A8/03.%20%E6%96%B0%E5%BB%BA%E4%BB%BB%E5%8A%A1/codes)，该笔记仅记录一些相对比较陌生的点。

### 工程初始化

- 使用最新的 vite 构建工具搭建工程

```shell
npm init vite-app todomvc
cd todomvc
npm i
npm run dev
```

- todomvc template

先到 github 上把 todomvc 的模板（[todomvc template](https://github.com/tastejs/todomvc-app-template)）给拉下来，执行 `npm i`，并将下面这两部分搬运到使用 vite 构建工具搭建的工程中。

| 模板部分 | 样式部分            |
| -------- | ------------------- |
| 模板部分 | section.todoapp     |
| 样式部分 | base.css、index.css |

模板部分直接丢到 App.vue 的 template 标签下边。样式部分直接丢到工程的 index.css 文件中。

结构和样式部分，直接用人家写好的就好，不用再自己动手写了。我们只要将业务逻辑给对接好就行。然后在开发过程中，为了实现业务逻辑，必然少不了去看它的结构代码的，同时可以学习学习 todomvc 的结构和样式的实现方式。

- 最终效果

![20211028152715](https://cdn.jsdelivr.net/gh/123taojiale/dahuyou_picture@main/blogs/20211028152715.png)

> 在 codes 目录下的 todomvc template vite 目录，就是已初始化的工程文件。

### 生成一个随机的 id

```js
function generateId() {
  return Date.now() + Math.random().toString(16).substr(2, 4);
}
```

`Date.now()`，生成一个当前时间的时间戳。

`Math.random().toString(16).substr(2, 4)`，生成一个随机小数，将其转换为 16进制，从小数点后开始取 4 位。

### watchEffect

官方文档：[watchEffect](https://v3.cn.vuejs.org/api/computed-watch-api.html#watcheffect)

### 需求

- 任务列表数据的存储问题
- 新增任务

![20211016161902](https://cdn.jsdelivr.net/gh/123taojiale/dahuyou_picture@main/blogs/20211016161902.png)

### 业务逻辑

- 响应式的任务列表

响应式的任务列表数据，其实就是使用 ref 函数处理一下我们从 localstorage 中获取到的 todoList。这样就能让我们获取到的任务列表数据成为相应式的数据了。

但是，使用 ref 处理过后，仅仅是同步了界面中的 todoList 和我们获取到的变量 todoList。我们还需要做一件事儿，就是当 todoList 发生变化时，要同时更新 localstorage 中的 todoList。若想要让 localstorage 中的 todoList 也成为相应式的数据，那么我们可以借助 watchEffect 这个 composition api 来实现。逻辑很简单，就是调用 watchEffect 这个 api，监听响应式数据 todoList，每当 todoList 发生变化时，我们就调用 localstorage.setItem 将它重新保存到 localstorage 中。

- 新增数据

首先，创建一个与输入框绑定的响应式变量。这样我们就可以实时获取到用户在输入框中输入的最新值。

然后，给输入框注册一个事件 @keyup.enter="xxx"，当用户按下回车键时，就会触发事件处理函数 xxx。在事件处理函数中，我们只要将新增的数据 push 到 todoList 中即可。由于 todoList 是一个相应式的数据，而且，当 todoList 的值发生变化时，会实时同步到 localstorage 中，所以，我们只需要将新增的对象给 push 到 todoList 中，就完成了新增数据的业务逻辑。

这里面还有一些细节，比方说：1. 我们在新增任务的时候，输入的任务内容是一个空字符串，那么我们就不应该执行新增操作；2. 我们 push 到 todoList 中的数据，不应该仅仅是一个（任务内容）字符串，应该传入的是一个任务对象，这个任务对象中包含该任务的一些必要信息，比如：该任务是否是完成状态，我们就可以给这个任务对象加一个字段 completed，它的初始值为 false，表示该任务未完成，同样的，我们也可以给任务对象添加其他信息，任务的id、任务的创建时间、任务的完成时间。。。等等。
