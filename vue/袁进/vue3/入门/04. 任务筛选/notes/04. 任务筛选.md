## 04. 任务筛选 {ignore}

[toc]

### 前言

- 时长：



### 需求

- 根据当前所选择的任务状态，对任务列表中的数据进行过滤展示。

![20211016162245](https://cdn.jsdelivr.net/gh/123taojiale/dahuyou_picture@main/blogs/20211016162245.png)

实现原理，本质上是通过监听 hash 值的变化来实现的。

| hash          | 激活按钮      | 展示任务               |
| ------------- | --------- | ------------------ |
| `all` 或 其他 | All       | 所有任务           |
| `active`      | Active    | 未完成的任务，即：`completed: false` |
| `completed`   | Completed | 已完成的任务，即：`completed: true`  |

正常情况下，hash 值是在用户点击状态按钮后，实现变化的。但是，也不排除是用户输入的，若用户输入的 hash 值是无效的 hash 值，那么就将改 hash 置空，并显示所有任务。

- 剩余任务数量。

![20211016162403](https://cdn.jsdelivr.net/gh/123taojiale/dahuyou_picture@main/blogs/20211016162403.png)

数字表示的是当前任务列表中未完成的任务数量。

当任务数量大于 1 时，item 的后面得加上 s。

- clear completed

![20211016162625](https://cdn.jsdelivr.net/gh/123taojiale/dahuyou_picture@main/blogs/20211016162625.png)

只要有任务未完成，那么就显示 Clear completed 按钮。

- 任务 完成、未完成 切换

![20211016181843](https://cdn.jsdelivr.net/gh/123taojiale/dahuyou_picture@main/blogs/20211016181843.png)

点击对应的任务前面的小圆圈后，切换任务的完成状态。

### 获取 hash

我们可以直接从 location 对象中，读取到 hash 值：`location.hash`。

| 地址栏                        | location.hash |
| ----------------------------- | ------------- |
| `http://localhost:3000/#/all` | `'#/all'`     |
| `http://localhost:3000/#all`  | `'#all'`      |
| `http://localhost:3000/#`     | `''`          |
| `http://localhost:3000/`      | `''`          |
| `http://localhost:3000`       | `''`          |

对于表格中的前面两种情况，我们只想读取到 `all`，而不想获取到多余的 `#`、`/`，那么应该如何读取呢？

可以暴力处理，无非就是判断一下第一个字符和第二个字符的内容，然后做判断即可。

袁老的解决方案：使用正则表达式来处理。

```js
location.hash.replace(/#\/?/, "")
```

`/#\/?/`，匹配以 `#` 开头的字符串，后面跟 `/`，并且 `/` 可以出现一次或多次。

> ![20211016164612](https://cdn.jsdelivr.net/gh/123taojiale/dahuyou_picture@main/blogs/20211016164612.png)
> 袁老在视频中提到的：在 vscode 中，正则表达式的在线测试插件。

---

[String.prototype.replace() mdn](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/replace)

Syntax：`str.replace(regexp|substr, newSubStr|function)`

上述这样的写法，将会使用 replace 函数的第二个参数 “空字符串” 来替换正则匹配上的内容。

### hashchange

问：如何监听 hash值 的变化？

答：绑定 `hashchange` 事件即可监听 hash值 的变化，每当 hash值 发生变化时，绑定的事件处理函数就会执行。

- HashChangeEvent

获取 hash 值的方式其实还有很多，除了使用 location.hash 来获取 hash，还可以通过 hashchange 事件触发时所传递的事件参数中获取。下面是事件参数中所包含的一些信息：

![20211028171732](https://cdn.jsdelivr.net/gh/123taojiale/dahuyou_picture@main/blogs/20211028171732.png)

如果我们要获取到当前的 hash 值，那么可以使用下面这种写法：

```js
const onHashChange = (hash) => {
  hash.newURL.replace(/.+#\/?/,""); // => completed
}

window.addEventListener("hashchange", onHashChange);
```

从这个对象中，我们还可以获取到更多其他信息，比如之前跳转过来的那个 url 值。

### onMounted、onUnmounted

它们是 vue3 的 composition api 的钩子函数，可以对比这 vue2 中的钩子函数来学习。

- onMounted 类似于 vue2 中的 mounted；
- onUnmounted 类似于 vue2 中的 unmounted；

官方文档：[composition api 生命周期钩子](https://v3.cn.vuejs.org/guide/composition-api-lifecycle-hooks.html)

---

```js
import {
  ref,
  onMounted,
  onUnmounted
} from "vue";

const onHashChange = () => {
  // => ...
}

// 组件挂载完成的生命周期函数
onMounted(() => {
  window.addEventListener("hashchange", onHashChange);
});
// 组件销毁过后的生命周期函数
onUnmounted(() => {
  window.removeEventListener("hashchange", onHashChange);
});
```

### computed

官方文档：[computed](https://v3.cn.vuejs.org/api/computed-watch-api.html#computed)

### checkbox

![20211016172537](https://cdn.jsdelivr.net/gh/123taojiale/dahuyou_picture@main/blogs/20211016172537.png)

阅读 todomvc 的样式和模板源码，尝试不使用 js 实现的一个 checkbox 效果。

源码：见 codes 目录下的 checkbox.html 文件。